"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1518],{1121:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>c});var t=s(4848),o=s(8453);const i={sidebar_position:5},a="Relations, Scopes and Validations",r={id:"Key-Concepts/markdown-features",title:"Relations, Scopes and Validations",description:"Relations",source:"@site/docs/Key-Concepts/markdown-features.mdx",sourceDirName:"Key-Concepts",slug:"/Key-Concepts/markdown-features",permalink:"/272_help/docs/Key-Concepts/markdown-features",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Ruby Gems",permalink:"/272_help/docs/Key-Concepts/deploy-your-site"},next:{title:"Congratulations!",permalink:"/272_help/docs/Key-Concepts/congratulations"}},l={},c=[{value:"Relations",id:"relations",level:2},{value:"Scopes",id:"scopes",level:2},{value:"scopes to sql",id:"scopes-to-sql",level:3},{value:"Validations",id:"validations",level:2}];function d(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"relations-scopes-and-validations",children:"Relations, Scopes and Validations"}),"\n",(0,t.jsx)(n.h2,{id:"relations",children:"Relations"}),"\n",(0,t.jsx)(n.p,{children:"Rails relations leverage Active Record associations to map relationships between different models. Recall in 67-250 and 67-262 where you learned about Entity relationship diagrams (ERD) and the Crow's foot notation. One of the most important terms to know when using crow's foot notation is cardinality. Cardinality acts as a parameter for the relationship between entities. For one entity, there is a minimum and maximum number that helps define its relationship with another entity."}),"\n",(0,t.jsx)(n.p,{children:"Here's how you can define the common types in rails:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"belongs_to"}),': Sets up a one-to-one connection with another model, such that each instance of the declaring model "belongs to" one instance of the other model.']}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"has_one"}),": Indicates that one other model has a reference to this model. It's used to establish a one-to-one relationship where the foreign key is held on the other table."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"has_many"}),": Describes a one-to-many connection with another model. This is used when a single instance of a model has zero or more instances of another model."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:["has_many ",":through"]})," and ",(0,t.jsxs)(n.strong,{children:["has_one ",":through"]}),": These associations set up a many-to-many or one-to-one connection with another model through a third model."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["For example, the entity ",(0,t.jsx)(n.code,{children:"officers"})," belongs to one and only one ",(0,t.jsx)(n.code,{children:"units"}),", while ",(0,t.jsx)(n.code,{children:"units"})," can have zero or more ",(0,t.jsx)(n.code,{children:"officers"}),". To set up the relation in rails:"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Officer Model (app/models/officer.rb)"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"class Officer < ApplicationRecord\n  belongs_to :unit\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Unit Model (app/models/unit.rb)"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"class Unit < ApplicationRecord\n  has_many :officers\nend\nend\n"})}),"\n",(0,t.jsx)(n.h2,{id:"scopes",children:"Scopes"}),"\n",(0,t.jsx)(n.p,{children:"Scopes allow defining common queries at the model level to promote reuse and readability. A use case for scopes is often for filtering by status, date, date ranges, ordering, groupings, and more. ActiveRecord already makes it quite easy to return rich data from your database. Combining those superpowers with scopes allow you to define more memorable queries that you and your team can harness through your Ruby on Rails application."}),"\n",(0,t.jsxs)(n.p,{children:["For example, you have an entity ",(0,t.jsx)(n.code,{children:"pets"})," with the following fields:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"name, pet_id, owner_id, female, date_of_birth, active\n"})}),"\n",(0,t.jsx)(n.p,{children:"Your model might look like this:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"The following example is taken from PATS"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"class Pet < ApplicationRecord\n  # Orders pets by their name in ascending order\n  scope :alphabetical, -> { order(:name) }\n\n  # Gets all active pets\n  scope :active, -> { where(active: true) }\n\n  # Gets all inactive pets\n  scope :inactive, -> { where(active: false) } # Changed to false for clarity\n\n  # Gets all female pets\n  scope :females, -> { where(female: true) }\n\n  # Gets all male pets\n  scope :males, -> { where(female: false) }\nend\n"})}),"\n",(0,t.jsx)(n.h3,{id:"scopes-to-sql",children:"scopes to sql"}),"\n",(0,t.jsx)(n.p,{children:"When you define scopes in a Rails model, under the hood, Active Record translates these scopes into SQL queries when you call them. However, this level of details is abstracted away so that it allows you to focus on the logic of your program. It's still important to understand what goes on behind the scenes and how 262 connects to what we are doing in this case. Here's how the scopes from the Pet model example correspond to SQL:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'-- Orders pets by their name in ascending order --\nSELECT "pets".* FROM "pets" ORDER BY "pets"."name" ASC\n\n-- Get all active pets --\nSELECT "pets".* FROM "pets" WHERE "pets"."active" = TRUE\n\n-- Get all inactive pets --\nSELECT "pets".* FROM "pets" WHERE "pets"."active" = FALSE\n\n-- Get all female pets --\nSELECT "pets".* FROM "pets" WHERE "pets"."female" = TRUE\n\n-- Get all male pets --\nSELECT "pets".* FROM "pets" WHERE "pets"."female" = FALSE\n'})}),"\n",(0,t.jsx)(n.h2,{id:"validations",children:"Validations"}),"\n",(0,t.jsx)(n.p,{children:"Validations ensure your application's data integrity by enforcing conditions that your models need to meet. Common validations include presence, uniqueness, and format validations."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Presence Validation"}),": Ensures that a specific field is not empty."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Uniqueness Validation"}),": Ensures that the value in a particular field is unique across the database."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Numericality Validation"}),": Ensures that a field contains only numbers and meets certain conditions like being greater than or equal to a specific value."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Format Validation"}),": Uses a regular expression to ensure the data entered into a field meets a specific format, such as an email address format validation."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"For example, you may add the following validations from the example above:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"# First, make sure a name exists\nvalidates :name, presence: true\n\n# Second, make sure the animal is one of the types PATS treats\nvalidate :animal_type_treated_by_PATS\n\n# Third, make sure the owner_id is in the PATS system \nvalidate :owner_is_active_in_PATS_system\n\n# Use private methods to execute the custom validations\n# -----------------------------\n  private\n  def animal_type_treated_by_PATS\n    is_active_in_system(:animal)\n  end\n  \n  def owner_is_active_in_PATS_system\n    is_active_in_system(:owner)\n  end\n"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>r});var t=s(6540);const o={},i=t.createContext(o);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);